
# 触摸反馈

## 事件分发机制

## MotionEvent

### 单点触控

事件类型：

- ACTION_DOWN： 手指 **初次接触到屏幕时** 触发。
- ACTION_MOVE：手指在 **屏幕上滑动** 时触发，会多次触发。
- ACTION_UP：手指 **离开屏幕** 时触发。
- ACTION_CANCEL：事件 **被上层拦截** 时触发
- ACTION_OUTSIDE：手指 **不在控件区域** 时触发（例如 Dialog）。

方法：

- getAction()：获取事件类型。
- getX()：获得触摸点在当前 View 的 X 轴坐标。
- getY()：获得触摸点在当前 View 的 Y 轴坐标。
- getRawX()：获得触摸点在整个屏幕的 X 轴坐标。
- getRawY()：获得触摸点在整个屏幕的 Y 轴坐标。


### 多点触控

事件类型：

- ACTION_DOWN： **第一个** 手指 **接触到屏幕时** 触发。
- ACTION_MOVE：手指在 **屏幕上滑动** 时触发，会多次触发。
- ACTION_UP：**最后一个** 手指 **离开屏幕** 时触发。
- ACTION_POINTER_DOWN：有非主要的手指按下(**即按下之前已经有手指在屏幕上**)。
- ACTION_POINTER_UP：有非主要的手指抬起(即抬起之后仍然有手指在屏幕上)。

方法：

- getActionMasked()：与 getAction() 类似，多点触控必须使用这个方法获取事件类型。
- getActionIndex()：获取该事件是哪个指针(手指)产生的。
- getPointerCount()：获取在屏幕上手指的个数。
- getPointerId(int pointerIndex)：获取一个指针(手指)的唯一标识符ID，在手指按下和抬起之间ID始终不变。
- findPointerIndex(int pointerId)：通过PointerId获取到当前状态下PointIndex，之后通过PointIndex获取其他内容。
- getX(int pointerIndex)：获取某一个指针(手指)的X坐标
- getY(int pointerIndex)：获取某一个指针(手指)的Y坐标

多点触控将index属性和事件类型合并以一个int作为标识，用最低8位(0x000000ff)表示事件类型，再往前的8位(0x0000ff00)表示事件编号。

追踪事件流，请认准 PointId，ActionIndex 只有在手指按下(down)和抬起(up)时是有用的。







## 触摸反馈算法

1. 重写 onTouchEvent()，在里面写上你的触摸反馈算法，并返回 true（是否消费事件取决于 ACTION_DOWN 事件或 ACTION_POINTER_DOWN 时是否返回 true），如果返回 false，则在这组触摸事件中永不接管当前事件流。
2. 如果是会发生触摸冲突的 ViewGroup，还需要重写 onInterceptTouchEvent()，在事件流开始时返回 false，并在确认接管事件流时返回一次 true，以实现对事件的拦截和接管，并在接管之后对它的子 View 发送一个额外的取消事件 CANCEL。
3. 当子 View 临时需要组织父 View 拦截事件流时，可以调用父 View 的 requestDisallowInterceptTouchEvent() ，通知父 View 在当前事件流中不再尝试通过 onInterceptTouchEvent() 来拦截。
4. onTouchEvent() 和  onInterceptTouchEvent() 都是在 dispatchTouchEvent() 中调用，一个事件分发的过程实质上就是从根 View 递归调用 dispatchTouchEvent() 的过程。

 
# 参考资料

- [触摸反馈 - HenCoder](https://hencoder.com/ui-3-1/)
- [MotionEvent详解 - GcsSloop](http://www.gcssloop.com/customview/motionevent)